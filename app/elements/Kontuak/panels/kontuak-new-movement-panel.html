<link rel="import" href="../../aitgud/form/input/aitgud-generated-uuid.html">
<link rel="import" href="../../../../bower_components/paper-button/paper-button.html">

<dom-module id="kontuak-new-movement-panel">

    <style>
        #errorMessage {
            width: 100%;
            text-align: left;
        }
        #errorMessage.no-error {
            display: none;
        }
    </style>
    <template>
        <paper-material elevation="1">
            <div id="errorMessage"></div>
            <form is="iron-form" method="post" action="http://127.0.0.1:8000/movements"
                    on-iron-form-response="handleResponse"
                    on-iron-form-error="handleError"
                    on-iron-form-submit="handleSubmit">
                <input is="aitgud-generated-uuid" name="movement[id]" />
                <paper-input name="movement[concept]" label="Concept"></paper-input>
                <paper-input-container>
                    <label>Amount</label>
                    <input is="iron-input" name="movement[amount]" type="number" min="0" step="0.01">
                </paper-input-container>
                <paper-input label="Date" name="movement[date]" type="date" noLabelFloat="true"></paper-input>
                <button type="submit">Create</button>
            </form>
        </paper-material>
    </template>

    <script>
        (function() {
            var noErrorClass = 'no-error';
            var defaultErrorMessage = 'There have been an error communicating to the server';

            Polymer({
                is: 'kontuak-new-movement-panel',
                attached: function() {
                    this.$.errorMessage.innerText = defaultErrorMessage;
                    this.$.errorMessage.classList.add(noErrorClass);
                },
                handleResponse: function() {
                    page.redirect('/');
                },
                handleError: function(error, request) {
                    var message;
                    try  {
                        if (request.request.xhr.readyState === 4 && request.request.xhr.response.message) {
                            message = request.request.xhr.response.message;
                        } else {
                            message = request.error;
                        }
                    } catch (e) {
                        if (window.console) {
                            console.error(e)
                        }
                        message = defaultErrorMessage;
                    }
                    this.$.errorMessage.innerText = message;
                    this.$.errorMessage.classList.remove(noErrorClass);
                },
                handleSubmit: function() {
                    this.$.errorMessage.classList.add(noErrorClass);
                }
            });
        })();
    </script>
</dom-module>